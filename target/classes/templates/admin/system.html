<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>系统监控 - 在线教育系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }
        .navbar {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .sidebar {
            background: white;
            min-height: calc(100vh - 76px);
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        .sidebar .nav-link {
            color: #495057;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e9ecef;
        }
        .sidebar .nav-link:hover {
            background-color: #f8f9fa;
            color: #dc3545;
        }
        .sidebar .nav-link.active {
            background-color: #dc3545;
            color: white;
        }
        .main-content {
            padding: 2rem;
        }
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }
        .card-header {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            padding: 1.5rem;
        }
        .admin-badge {
            background: #dc3545;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }
        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            border: none;
            border-radius: 10px;
        }
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .system-card {
            background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);
            color: white;
            border-radius: 15px;
        }
        .system-card.cpu {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        }
        .system-card.memory {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }
        .system-card.disk {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: #212529;
        }
        .system-card.network {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        .danger-warning {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            text-align: center;
        }
        .progress-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
        .progress-good {
            background: conic-gradient(#28a745 0deg 216deg, #e9ecef 216deg 360deg);
        }
        .progress-warning {
            background: conic-gradient(#ffc107 0deg 288deg, #e9ecef 288deg 360deg);
        }
        .progress-danger {
            background: conic-gradient(#dc3545 0deg 324deg, #e9ecef 324deg 360deg);
        }
        .status-online {
            color: #28a745;
        }
        .status-warning {
            color: #ffc107;
        }
        .status-offline {
            color: #dc3545;
        }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .terminal-output {
            background: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 1rem;
            border-radius: 5px;
            height: 200px;
            overflow-y: auto;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/edu/admin/dashboard">
                <i class="fas fa-shield-alt me-2"></i>管理后台
            </a>
            
            <div class="navbar-nav ms-auto">
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user-shield me-1"></i>
                        <span th:text="${user != null ? user.realName : '管理员'}">管理员</span>
                        <span class="admin-badge">ADMIN</span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/edu/admin/profile">
                            <i class="fas fa-user me-2"></i>管理员资料
                        </a></li>
                        <li><a class="dropdown-item" href="/edu/admin/settings">
                            <i class="fas fa-cog me-2"></i>系统设置
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="/edu/student/dashboard">
                            <i class="fas fa-user me-2"></i>切换到学生视图
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="/edu/auth/logout">
                            <i class="fas fa-sign-out-alt me-2"></i>退出登录
                        </a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- 侧边栏 -->
            <div class="col-md-3 col-lg-2 px-0">
                <div class="sidebar">
                    <nav class="nav flex-column">
                        <a class="nav-link" href="/edu/admin/dashboard">
                            <i class="fas fa-tachometer-alt me-2"></i>仪表板
                        </a>
                        <a class="nav-link" href="/edu/admin/users">
                            <i class="fas fa-users me-2"></i>用户管理
                        </a>
                        <a class="nav-link" href="/edu/admin/profile">
                            <i class="fas fa-user me-2"></i>管理员资料
                        </a>
                        <a class="nav-link" href="/edu/admin/courses">
                            <i class="fas fa-book me-2"></i>课程管理
                        </a>
                        <a class="nav-link" href="/edu/admin/orders">
                            <i class="fas fa-shopping-cart me-2"></i>订单管理
                        </a>
                        <a class="nav-link" href="/edu/admin/coupons">
                            <i class="fas fa-ticket-alt me-2"></i>优惠券管理
                        </a>
                        <a class="nav-link" href="/edu/admin/financial">
                            <i class="fas fa-chart-line me-2"></i>财务报表
                            <span class="admin-badge">机密</span>
                        </a>
                        <a class="nav-link active" href="/edu/admin/system">
                            <i class="fas fa-server me-2"></i>系统监控
                            <span class="admin-badge">高危</span>
                        </a>
                        <a class="nav-link" href="/edu/admin/logs">
                            <i class="fas fa-file-alt me-2"></i>系统日志
                            <span class="admin-badge">敏感</span>
                        </a>
                    </nav>
                </div>
            </div>

            <!-- 主内容区 -->
            <div class="col-md-9 col-lg-10">
                <div class="main-content">
                    <!-- 高危操作警告 -->
                    <div class="danger-warning">
                        <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
                        <h5>高危系统操作区域</h5>
                        <p class="mb-0">此页面可执行系统级操作，可能影响服务器稳定性。请谨慎操作，所有操作将被记录。</p>
                    </div>

                    <!-- 页面标题 -->
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2><i class="fas fa-server me-2"></i>系统监控</h2>
                        <div>
                            <button class="btn btn-danger me-2">
                                <i class="fas fa-sync me-1"></i>刷新数据
                            </button>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="/edu/admin/dashboard">仪表板</a></li>
                                    <li class="breadcrumb-item active">系统监控</li>
                                </ol>
                            </nav>
                        </div>
                    </div>

                    <!-- 系统资源监控 -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card system-card cpu text-center">
                                <div class="card-body">
                                    <i class="fas fa-microchip fa-2x mb-3"></i>
                                    <div class="progress-circle progress-good mx-auto mb-3">
                                        <span>60%</span>
                                    </div>
                                    <h6>CPU使用率</h6>
                                    <small>Intel i7-9700K</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card system-card memory text-center">
                                <div class="card-body">
                                    <i class="fas fa-memory fa-2x mb-3"></i>
                                    <div class="progress-circle progress-warning mx-auto mb-3">
                                        <span>80%</span>
                                    </div>
                                    <h6>内存使用率</h6>
                                    <small>12.8GB / 16GB</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card system-card disk text-center">
                                <div class="card-body">
                                    <i class="fas fa-hdd fa-2x mb-3"></i>
                                    <div class="progress-circle progress-danger mx-auto mb-3">
                                        <span>90%</span>
                                    </div>
                                    <h6>磁盘使用率</h6>
                                    <small>450GB / 500GB</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card system-card network text-center">
                                <div class="card-body">
                                    <i class="fas fa-network-wired fa-2x mb-3"></i>
                                    <div class="progress-circle progress-good mx-auto mb-3">
                                        <span>45%</span>
                                    </div>
                                    <h6>网络使用率</h6>
                                    <small>45Mbps / 100Mbps</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 系统性能图表 -->
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">
                                        <i class="fas fa-chart-line me-2"></i>系统性能监控
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="performanceChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">
                                        <i class="fas fa-list me-2"></i>系统进程
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>进程</th>
                                                    <th>CPU</th>
                                                    <th>内存</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>java</td>
                                                    <td>45%</td>
                                                    <td>2.1GB</td>
                                                </tr>
                                                <tr>
                                                    <td>mysql</td>
                                                    <td>12%</td>
                                                    <td>1.8GB</td>
                                                </tr>
                                                <tr>
                                                    <td>nginx</td>
                                                    <td>3%</td>
                                                    <td>256MB</td>
                                                </tr>
                                                <tr>
                                                    <td>redis</td>
                                                    <td>2%</td>
                                                    <td>128MB</td>
                                                </tr>
                                                <tr>
                                                    <td>system</td>
                                                    <td>8%</td>
                                                    <td>512MB</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 服务状态监控 -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">
                                        <i class="fas fa-cogs me-2"></i>服务状态
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-6 mb-3">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-circle status-online me-2"></i>
                                                <div>
                                                    <div class="fw-bold">Web服务</div>
                                                    <small class="text-muted">运行正常</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6 mb-3">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-circle status-online me-2"></i>
                                                <div>
                                                    <div class="fw-bold">数据库</div>
                                                    <small class="text-muted">运行正常</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6 mb-3">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-circle status-warning me-2"></i>
                                                <div>
                                                    <div class="fw-bold">缓存服务</div>
                                                    <small class="text-muted">负载较高</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6 mb-3">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-circle status-online me-2"></i>
                                                <div>
                                                    <div class="fw-bold">文件服务</div>
                                                    <small class="text-muted">运行正常</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6 mb-3">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-circle status-offline me-2"></i>
                                                <div>
                                                    <div class="fw-bold">邮件服务</div>
                                                    <small class="text-muted">连接异常</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6 mb-3">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-circle status-online me-2"></i>
                                                <div>
                                                    <div class="fw-bold">支付服务</div>
                                                    <small class="text-muted">运行正常</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">
                                        <i class="fas fa-terminal me-2"></i>系统命令执行
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <div class="input-group">
                                            <input type="text" class="form-control" placeholder="输入系统命令..." id="commandInput">
                                            <button class="btn btn-danger" type="button" onclick="executeCommand()">
                                                <i class="fas fa-play me-1"></i>执行
                                            </button>
                                        </div>
                                        <small class="text-danger">
                                            <i class="fas fa-exclamation-triangle me-1"></i>
                                            危险操作：系统命令可能影响服务器稳定性
                                        </small>
                                    </div>
                                    <div class="terminal-output" id="terminalOutput">
                                        root@edu-server:~# ps aux | grep java<br>
                                        root      1234  45.2  13.1 4567890 2123456 ?   Sl   10:30   2:15 java -jar edu-logic-vul.jar<br>
                                        root@edu-server:~# df -h<br>
                                        Filesystem      Size  Used Avail Use% Mounted on<br>
                                        /dev/sda1       500G  450G   50G  90% /<br>
                                        tmpfs           8.0G     0  8.0G   0% /dev/shm<br>
                                        root@edu-server:~# free -m<br>
                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total        used        free      shared  buff/cache   available<br>
                                        Mem:           16384       12800        1024         256        2560        3328<br>
                                        Swap:           2048         512        1536<br>
                                        root@edu-server:~# _
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 系统信息 -->
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-info-circle me-2"></i>系统信息
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <table class="table table-borderless">
                                        <tr>
                                            <td><strong>操作系统:</strong></td>
                                            <td>Ubuntu 20.04.3 LTS</td>
                                        </tr>
                                        <tr>
                                            <td><strong>内核版本:</strong></td>
                                            <td>5.4.0-88-generic</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Java版本:</strong></td>
                                            <td>OpenJDK 11.0.16</td>
                                        </tr>
                                        <tr>
                                            <td><strong>应用版本:</strong></td>
                                            <td>edu-logic-vul v1.0.0</td>
                                        </tr>
                                        <tr>
                                            <td><strong>启动时间:</strong></td>
                                            <td>2024-09-04 10:30:15</td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="col-md-6">
                                    <table class="table table-borderless">
                                        <tr>
                                            <td><strong>服务器IP:</strong></td>
                                            <td>192.168.1.100</td>
                                        </tr>
                                        <tr>
                                            <td><strong>数据库:</strong></td>
                                            <td>MySQL 8.0.30</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Web服务器:</strong></td>
                                            <td>Nginx 1.18.0</td>
                                        </tr>
                                        <tr>
                                            <td><strong>运行时长:</strong></td>
                                            <td>2天 15小时 30分钟</td>
                                        </tr>
                                        <tr>
                                            <td><strong>负载均衡:</strong></td>
                                            <td>0.65, 0.72, 0.58</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 危险操作警告 -->
                    <div class="alert alert-danger mt-4" role="alert">
                        <i class="fas fa-skull-crossbones me-2"></i>
                        <strong>危险操作警告：</strong>
                        此页面包含系统级操作功能，错误的操作可能导致服务器崩溃或数据丢失。所有操作都将被详细记录，请确保您有足够的权限和技术能力。
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 系统性能监控图表
        const performanceCtx = document.getElementById('performanceChart').getContext('2d');
        new Chart(performanceCtx, {
            type: 'line',
            data: {
                labels: ['10:30', '10:35', '10:40', '10:45', '10:50', '10:55', '11:00', '11:05', '11:10'],
                datasets: [{
                    label: 'CPU使用率',
                    data: [45, 52, 48, 60, 55, 58, 62, 59, 60],
                    borderColor: '#007bff',
                    backgroundColor: 'rgba(0, 123, 255, 0.1)',
                    tension: 0.4
                }, {
                    label: '内存使用率',
                    data: [75, 76, 78, 80, 79, 81, 80, 82, 80],
                    borderColor: '#28a745',
                    backgroundColor: 'rgba(40, 167, 69, 0.1)',
                    tension: 0.4
                }, {
                    label: '磁盘使用率',
                    data: [88, 89, 89, 90, 90, 90, 90, 90, 90],
                    borderColor: '#ffc107',
                    backgroundColor: 'rgba(255, 193, 7, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    }
                }
            }
        });

        // 模拟命令执行
        function executeCommand() {
            const input = document.getElementById('commandInput');
            const output = document.getElementById('terminalOutput');
            const command = input.value.trim();
            
            if (command) {
                output.innerHTML += `<br>root@edu-server:~# ${command}<br>`;
                
                // 模拟命令输出
                setTimeout(() => {
                    if (command.includes('ls')) {
                        output.innerHTML += 'edu-logic-vul.jar  logs/  config/  data/<br>';
                    } else if (command.includes('top')) {
                        output.innerHTML += 'PID    USER     %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND<br>';
                        output.innerHTML += '1234   root     45.2 13.1 4567890 2123456 ?   Sl   10:30   2:15 java<br>';
                    } else if (command.includes('rm') || command.includes('delete')) {
                        output.innerHTML += '<span style="color: #ff0000;">ERROR: 危险操作被阻止！</span><br>';
                    } else {
                        output.innerHTML += '命令执行完成<br>';
                    }
                    output.innerHTML += 'root@edu-server:~# _';
                    output.scrollTop = output.scrollHeight;
                }, 500);
                
                input.value = '';
            }
        }

        // 回车执行命令
        document.getElementById('commandInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                executeCommand();
            }
        });

        // 定时刷新数据
        setInterval(() => {
            // 这里可以添加AJAX请求来获取实时数据
            console.log('刷新系统监控数据...');
        }, 30000);
    </script>
</body>
</html>